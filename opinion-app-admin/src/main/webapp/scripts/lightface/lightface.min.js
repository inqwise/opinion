;
(function ($) {
    lightFace = function (a) {
        var d = $(this),
        options = $.extend({
            width: 'auto',
            height: 'auto',
            title: "",
            message: "<p>Message not specified.</p>",
            errorMessage: "<p>The requested file could not be found.</p>",
            actions: [],
            fadeDelay: 400,
            fadeDuration: 400,
            zIndex: 9001,
            pad: 100,
            overlayAll: false,
            constrain: false,
            resetOnScroll: true,
            resizeOnOpen: true,
            complete: null,
            abort : null
        }, a);
        var f = null;
        var g = null;
        var h = null;
        var i = function () {
            if (options.complete != undefined && typeof options.complete == 'function') options.complete()
        };
        var j = function () {
            if (options.overlayAll) {
                g.show()
            }
            $('.lightface-content-overlay').hide();
            var E = f.find('.lightface-actions');
            if (options.actions.length > 0) {
                E.show().empty();
                for (var t = 0; t < options.actions.length; t++) {
                    var c = $("<a href=\"javascript:;\" action=\"" + t + "\" title=\"" + (options.actions[t].label ? options.actions[t].label : "Action" + t) + "\" class=\"button-" + (options.actions[t].color != undefined ? options.actions[t].color : "blue") + "\"><span>" + (options.actions[t].label ? options.actions[t].label : "Action" + t) + "</span></a>").click(function () {
                        var o = $(this);
                        var b = o.attr('action');
                        if (options.actions[b].fire != undefined && typeof options.actions[b].fire == 'function') {
                            options.actions[b].fire()
                        }
                    }).appendTo(E)
                }
            } else {
                E.hide().empty()
            }
            var T = f.find('.lightface-title');
            if (options.title.length != 0) {
                T.show().empty().text(options.title)
            } else {
                T.hide().empty()
            }
            $('.lightface-message').empty().html(options.message);
            h.css({
                'top': $(window).scrollTop() + ($(window).height() - (h.height())) / 2 + 'px',
                'left': $(window).scrollLeft() + ($(window).width() - (h.width())) / 2 + 'px'
            });
            i()
        };
        var k = function () {};
        var l = function () {
            g.hide();
            h.css({
                "top": "-9000px",
                "left": "-9000px"
            });
            $('.lightface-control').remove()
        };
        var m = function () {
            this.state = false;
            this.resizeOnOpen = true;
            this.ie6 = typeof document.body.style.maxHeight == "undefined";
            $('.lightface-control').remove();
            f = $("<div class=\"lightface-control\">" + "<div class=\"lightface\">" + "<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"table-layout:fixed;\">" + "<tbody>" + "<tr>" + "<td class=\"top-left\"></td>" + "<td class=\"top-center\"></td>" + "<td class=\"top-right\"></td>" + "</tr>" + "<tr>" + "<td class=\"middle-left\"></td>" + "<td class=\"middle-center\">" + "<div class=\"lightface-content\">" + "<h2 class=\"lightface-title\"></h2>" + "<div class=\"lightface-message\"></div>" + "<div class=\"lightface-actions\"></div>" + "<div class=\"lightface-content-overlay\"></div>" + "</div>" + "</td>" + "<td class=\"middle-right\"></td>" + "</tr>" + "<tr>" + "<td class=\"bottom-left\"></td>" + "<td class=\"bottom-center\"></td>" + "<td class=\"bottom-right\"></td>" + "</tr>" + "</tbody>" + "</table>" + "</div>" + "<div class=\"lightface-overlay\"></div>" + "</div>").appendTo(document.body);
            h = f.find('.lightface');
            g = f.find('.lightface-overlay');
            $(window).resize(function () {
                h.css({
                    'top': $(window).scrollTop() + ($(window).height() - (h.height())) / 2 + 'px',
                    'left': $(window).scrollLeft() + ($(window).width() - (h.width())) / 2 + 'px'
                })
            });
            $(window).scroll(function () {
                h.css({
                    'top': $(window).scrollTop() + ($(window).height() - (h.height())) / 2 + 'px',
                    'left': $(window).scrollLeft() + ($(window).width() - (h.width())) / 2 + 'px'
                })
            });
            document.onkeyup = function (e) {
                if (e == null) {
                    keycode = event.keyCode
                } else {
                    keycode = e.which
                }
                if (keycode == 27) {
                	
                	if(options.abort != undefined 
            			&& typeof options.abort == 'function') {
            			options.abort();
                	}
                	
                    l()
                }
            };
            j()
        };
        m();
        return {
            open: function () {
                k()
            },
            close: function () {
                l()
            },
            reset: function () {},
            load: function (o) {},
            destroy: function () {},
            resize : function() {
            	if(h != null) {
            		h.css({
                        'top': $(window).scrollTop() + ($(window).height() - (h.height())) / 2 + 'px',
                        'left': $(window).scrollLeft() + ($(window).width() - (h.width())) / 2 + 'px'
                    })
            	}
            }
        }
    }
})(jQuery);